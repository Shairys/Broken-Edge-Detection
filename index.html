<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="jimp.js"></script>
    <script>
    Jimp.read("lenna.jpg").then(function (lenna) {

        lenna.getBase64(Jimp.MIME_JPEG, function (err, src) {
                var img = document.createElement("img");
                img.setAttribute("src", src);
                document.body.appendChild(img);
            })     
            .greyscale()                 // set greyscale
            .convolute([[1, 0, -1], [2, 0, -2], [1, 0, -1]])
            .getBase64(Jimp.MIME_JPEG, function (err, src) {
                var img = document.createElement("img");
                img.setAttribute("src", src);
                document.body.appendChild(img);
            });

        Jimp.read("lenna.jpg").then(function (lenna2) {
        lenna2.getBase64(Jimp.MIME_JPEG, function (err, src) {
                var img = document.createElement("img");
                img.setAttribute("src", src);
                document.body.appendChild(img);
            })     
            .greyscale()                 // set greyscale
            .convolute([[1, 2, 1], [0, 0, 0], [-1, -2, -1]])

            .getBase64(Jimp.MIME_JPEG, function (err, src) {
                var img = document.createElement("img");
                img.setAttribute("src", src);
                document.body.appendChild(img);
            })
            
            for(i = 0; i < lenna2.bitmap.height * lenna2.bitmap.width*4; i++){
                    lenna2.bitmap.data[i] += lenna.bitmap.data[i];
                }

            lenna2.getBase64(Jimp.MIME_JPEG, function (err, src) {
                var img = document.createElement("img");
                img.setAttribute("src", src);
                document.body.appendChild(img);
            })
    }).catch(function (err) {
        console.error(err);
    });



    }).catch(function (err) {
        console.error(err);
    });
    </script>
    <script>
        let inputSet = false;

        function bufferToBase64(buffer){
            let output = "";
            let data = new Uint8Array(buffer);
            for (let i = 0; i < data.byteLength; i++) {
                output += String.fromCharCode(data[i]);
            }
            return window.btoa(output);
        }

        function showImage(base64, parent){
            const previewContainer = document.querySelector("#preview-container");
            let src = "data:image/jpg;base64," + base64;
            let img = document.createElement("img");
            img.setAttribute("src", src);
            parent.appendChild(img);
        }

        function clear(){
            let images = document.querySelectorAll(".output img");
            for (let i = 0; i < images.length; i++) {
                images[i].remove();
            }
        }

        function processInput(){
            const inputFileElement = document.querySelector(".input input[name=file]");
            const fileList = inputFileElement.files;
            const file = fileList[0];
            const inputElement = document.querySelector("#input-container");
            const outputElement = document.querySelector("#output-container");

            if (file && file.type.startsWith("image")) {
                const reader = new FileReader();
                reader.readAsArrayBuffer(file);
                reader.addEventListener("load", function(){
                    if (inputSet) clear();
                    inputSet = true;
                    let buffer = reader.result;
                    showImage(bufferToBase64(buffer), inputElement);

                    // processing

                    // showImage(outputSrc, outputElement)

                });
            }
        }
    </script>
    <link href="style.css" type="text/css" rel="stylesheet">
</head>
<body>
    <!-- todo: regulacja parametrów, responsywność -->
    <div class="interface">
        <div class="input">
            <label for="file">Wybierz zdjęcie: </label>
            <input type="file" name="file" /><br />
            <input type="button" name="confirmation" value="Potwierdź" onclick="processInput()" />
        </div>
        <div class="config">
            <label for="placeholder1">placeholder1: </label>
            <input type="range" name="placeholder1" /> <br />
            <label for="placeholder2">placeholder2: </label>
            <input type="range" name="placeholder2" /> <br />
            <label for="placeholder3">placeholder3: </label>
            <input type="range" name="placeholder3" /> <br />
            <!--
                regulacja parametrów
                użyć onchange="processInput()"
            -->
        </div>
    </div>
    <div class="output">
        <div id="input-container">
            <p>Plik wejściowy: </p>
        </div>
        <div id="output-container">
            <p>Plik wyjściowy: </p>
        </div>
    </div>
    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
</body>
</html>